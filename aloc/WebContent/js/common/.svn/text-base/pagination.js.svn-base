/*Generated by CoffeeScript 1.3.3*/
(function() {

  $(function() {
    var buildNavigation, gotoPage,table=null;
    var showPerPage = 10;
    var totalRows = gettableRow().length;
    var numberOfPages = Math.ceil(totalRows / showPerPage);
   
    if(totalRows <=10){
		   $('div#hideLessthan10').hide();
		   $('div#searchSort').children('.rightColSort').hide();
	   }
    
    $("#current_page").val(1);
	
	function paginationSize(){
    	return parseInt($("select.pagination-rows").val());
    }

    $("select.pagination-rows").change(function(){
    	var v = parseInt($("#current_page").val()); 
        showPerPage=paginationSize();
        numberOfPages = Math.ceil(totalRows / showPerPage);
        if(totalRows <= showPerPage){
        	return gotoPage(1);
        }else{
        	if(numberOfPages < v){
        		return gotoPage(numberOfPages);
        	}else{
        		return gotoPage(v);
        	}
        }
    });

   /*
    *	Build pagination links
    */

    function gettableRow(){
      getTable();
      var result;
      if($(table).length > 1)
          result = $(table).filter(".active");  
      else {
    	  result = table;
      }
      return $(result).find("tbody tr.shown");
    }
    
    /**
     * 
     */
    function getTable() {
    	var isDiv = $("div.tab-content");
        /*var table = null;*/
        if($(isDiv).length > 0 ){
      	  $(isDiv).each(function(){
      		  if($(this).attr("id") == 'myDashboardTabContent'){
      			  table = $(this).find("div.active table.paginate");
      		  }
      	  });
      	  if(table == undefined && $("table.paginate") != undefined){
      		  table = $("table.paginate");
      	  }
        }else{
          table = $("table.paginate");
        }
        return table;
    }

    buildNavigation = function(currentPage) {
      var dummy, item, middle, next, pageNo, previous;     
      pageNo = 1;
      totalRows = gettableRow().length;
      numberOfPages = Math.ceil(totalRows / showPerPage);
      middle = Math.ceil(numberOfPages / 2);
      previous = $('<a class="page larger" href="#">&#60;</a>');
      next = $('<a class="page larger" href="#">&#62;</a>');
      $('.pagenavi').empty();
      $('.pagenavi ').append(previous);
      while (numberOfPages >= pageNo) {
        item = $('<a class="page larger" href="#">' + pageNo + '</a>');
        if (numberOfPages <= 9 || (pageNo === 1 || pageNo === 2 || pageNo === (numberOfPages - 1) || pageNo === numberOfPages)) {
          $('.pagenavi').append(item);
        } else if (currentPage === 2 && (pageNo === 3 || pageNo === 4 || pageNo === 5)) {
          $('.pagenavi').append(item);
        } else if (currentPage === numberOfPages - 1 && (pageNo === (numberOfPages - 4) || pageNo === (numberOfPages - 3) || pageNo === (numberOfPages - 2))) {
          $('.pagenavi').append(item);
        } else if ((pageNo === (middle - 1) || pageNo === middle || pageNo === (middle + 1)) && (currentPage === 1 || currentPage === numberOfPages)) {
          $('.pagenavi').append(item);
        } else if (currentPage === (pageNo - 1) || currentPage === pageNo || currentPage === (pageNo + 1)) {
          $('.pagenavi').append(item);
        } else {
        	if ($('.pagenavi').find('a:last').text() !== '----') {
            dummy = $('<a class="page larger" href="#">----</a>');
            $('.pagenavi').append(dummy);
          }
        }
        $(item).click(function() {
          return gotoPage(parseInt($(this).html()));
        });
        pageNo++;
      }
      $('.pagenavi').append(next);
      if (numberOfPages < 2) {
        $(next).addClass('disabled');
      }
    };
    /*
    	Navigates to given page number
    */

    gotoPage = function(page) {
      var el, end, start;
      var table = getTable();
      $(table).find('tbody tr').each(function() {
    	  if($(this).hasClass('innerRow')){
    		  $(this).prev('tr').find('#arrow').removeClass("up");
    		  $(this).prev('tr').find('#arrow').addClass("down");
    		  $(this).remove();
    	  } 
      });
      
      start = (page - 1) * showPerPage;
      end = start + showPerPage;  
      el = gettableRow(); 
      $(el).each(function() {
    	  $(this).hide();
      });
      
      $(el).slice(start, end).each(function() {
    	  $(this).show();
      });
      buildNavigation(page);
      if($(el).length == 1){
    	  if($(table).find('tbody tr:first').hasClass('noRecord')){
    		  $("#itemsPerPage,#itemsPerPage1").hide();
    		  $("#noItemsFound,#noItemsFound1").show();
    	  }else{
    		  $("#itemsPerPage,#itemsPerPage1").show();
    		  $("#noItemsFound,#noItemsFound1").hide();
    		  $("#itemsPerPage,#itemsPerPage1").find("span#start").text(start+1);
    	      if(end > totalRows){
    	    	  end = totalRows;
    	      }
    	      $("#itemsPerPage,#itemsPerPage1").find("span#end").text(end);
    	      $("#itemsPerPage,#itemsPerPage1").find("span#total").text(totalRows);
    	  }
      }else{
    	  $("#itemsPerPage,#itemsPerPage1").show();
		  $("#noItemsFound,#noItemsFound1").hide();
    	  $("#itemsPerPage,#itemsPerPage1").find("span#start").text(start+1);
          if(end > totalRows){
        	  end = totalRows;
          }
          $("#itemsPerPage,#itemsPerPage1").find("span#end").text(end);
          $("#itemsPerPage,#itemsPerPage1").find("span#total").text(totalRows);
      }
      
      $('.pagenavi a').each(function() {
        if ($(this).html() === page.toString()) {
          return $(this).replaceWith('<span class="current">'+page+'</span>');
        }
      });
      $("#current_page").val(page);
      switch (page) {
        case 1:
          $(".pagenavi a:first-child").addClass('disabled');
          $(".pagenavi a:last-child").removeClass('disabled');
          break;
        case numberOfPages:
          $(".pagenavi a:last-child").addClass('disabled');
          $(".pagenavi a:first-child").removeClass('disabled');
          break;
        default:
          $(".pagenavi a:first-child").removeClass('disabled');
          $(".pagenavi a:last-child").removeClass('disabled');
          break;
      }
    };

    window.gotoPage = gotoPage(1);

    $('.pagenavi').off('click.pagination', 'a:first-child');
    $('.pagenavi').on('click.pagination', 'a:first-child', function() {
      if(!$(this).hasClass('disabled')){
    	  var i;
          i = parseInt($("#current_page").val());
          if (i !== 1) {
            return gotoPage(i - 1);
          }
      }
    });
    
    $('.pagenavi').off('click.pagination', 'a:last-child');
    $('.pagenavi').on('click.pagination', 'a:last-child', function() {
    	if(!$(this).hasClass('disabled')){
	    	var i;
	      i = parseInt($("#current_page").val());
	      if (i !== numberOfPages) {
	        return gotoPage(i + 1);
	      }
    	}
    });
    buildNavigation(1);
    $(".pagenavi a:first-child").addClass('disabled');
    $('.pagenavi a:nth-child(2)').replaceWith('<span class="current">1</span>');
    $(".table.active tbody tr").hide();
    $(".table.active tbody tr").slice(0, showPerPage).show();
    $(".jump-page").find('.btn-success-blue').click(function() {
      var val = 0;
      if ($(this).siblings('.manual').val()) {
        val = parseInt($(this).siblings('.manual').val());
      }
      if (val >= 1 && val <= numberOfPages) {
        return gotoPage(val);
      }
    });
    $(".jump-page").find('.manual').keyup(function(e) {
      if (e.which === 13) {
        return $(".jump-page").find('.btn-success-blue').click();
      }
    });
    $(".jump-page").find('.btn-goto-FirstPage').click(function() {
    	var cp = parseInt($("#current_page").val());
    	return gotoPage(cp);
    });
  });

  
}).call(this);
